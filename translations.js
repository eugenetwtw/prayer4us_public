// Translations for the website
const translations = {
    // Traditional Chinese (Default)
    'zh-Hant': {
        title: 'æˆ‘é™ªæ‚¨ç¦±å‘Š',
        backButton: 'â†© ä¸Šä¸€å€‹æƒ…ç·’åˆ—è¡¨',
        loadingEmotions: 'â³ æ­£åœ¨å°‹æ‰¾æ›´å¤šæƒ…ç·’...',
        customEmotionLabel: 'è«‹æè¿°æ‚¨ç›®å‰çš„å›°é›£ç‹€æ³ï¼š',
        submitButton: 'æäº¤',
        resetButton: 'é‡æ–°é¸æ“‡æƒ…ç·’',
        otherSituation: 'æˆ‘æœ‰å…¶ä»–ç‹€æ³',
        loadingVerse: 'â³ æ­£åœ¨å°‹æ‰¾åˆé©çš„ç¶“æ–‡...',
        verseForEmotion: 'ðŸ“– çµ¦æ­£åœ¨ç¶“æ­·ã€Œ{emotion}ã€çš„ä½ ï¼š',
        scripture: 'ç¶“æ–‡ï¼š',
        explanation: 'èªªæ˜Žï¼š',
        prayer: 'ç¦±å‘Šè©žï¼š',
        playPrayer: 'â–¶ æ’­æ”¾ç¦±å‘Šè©ž',
        generatingAudio: 'â³ ç”ŸæˆéŸ³é »ä¸­...',
        voiceSelector: 'é¸æ“‡è²éŸ³',
        alloy: 'Alloy (å¹³è¡¡)',
        echo: 'Echo (æ·±æ²‰)',
        fable: 'Fable (æº«æš–)',
        onyx: 'Onyx (å¼·å‹)',
        nova: 'Nova (å‹å–„)',
        shimmer: 'Shimmer (æ˜Žäº®)',
        apiKeyNotSet: 'âŒ APIé‡‘é‘°æœªè¨­ç½®ï¼Œç„¡æ³•ç²å–ç¶“æ–‡',
        errorGettingVerse: 'âŒ ç²å–ç¶“æ–‡æ™‚å‡ºéŒ¯ï¼Œè«‹ç¨å¾Œå†è©¦',
        audioPlayError: 'ç„¡æ³•æ’­æ”¾éŸ³é »ï¼Œè«‹ç¨å¾Œå†è©¦',
        parseError: 'âš ï¸ æœªèƒ½è§£æžå›žæ‡‰ï¼Œä»¥ä¸‹æ˜¯åŽŸå§‹å…§å®¹ï¼š',
        apiKeyNotSetAudio: 'APIé‡‘é‘°æœªè¨­ç½®ï¼Œç„¡æ³•æ’­æ”¾éŸ³é »',
        languageSelector: 'Language',
        continuePrayer: 'æŽ¥çºŒæ›´é•·çš„ç¦±å‘Š',
        prayerLabel: 'ç¦±å‘Šè©ž'
    },
    // Simplified Chinese
    'zh-Hans': {
        title: 'æˆ‘é™ªæ‚¨ç¥·å‘Š',
        backButton: 'â†© ä¸Šä¸€ä¸ªæƒ…ç»ªåˆ—è¡¨',
        loadingEmotions: 'â³ æ­£åœ¨å¯»æ‰¾æ›´å¤šæƒ…ç»ª...',
        customEmotionLabel: 'è¯·æè¿°æ‚¨ç›®å‰çš„å›°éš¾çŠ¶å†µï¼š',
        submitButton: 'æäº¤',
        resetButton: 'é‡æ–°é€‰æ‹©æƒ…ç»ª',
        otherSituation: 'æˆ‘æœ‰å…¶ä»–çŠ¶å†µ',
        loadingVerse: 'â³ æ­£åœ¨å¯»æ‰¾åˆé€‚çš„ç»æ–‡...',
        verseForEmotion: 'ðŸ“– ç»™æ­£åœ¨ç»åŽ†ã€Œ{emotion}ã€çš„ä½ ï¼š',
        scripture: 'ç»æ–‡ï¼š',
        explanation: 'è¯´æ˜Žï¼š',
        prayer: 'ç¥·å‘Šè¯ï¼š',
        playPrayer: 'â–¶ æ’­æ”¾ç¥·å‘Šè¯',
        generatingAudio: 'â³ ç”ŸæˆéŸ³é¢‘ä¸­...',
        voiceSelector: 'é€‰æ‹©å£°éŸ³',
        alloy: 'Alloy (å¹³è¡¡)',
        echo: 'Echo (æ·±æ²‰)',
        fable: 'Fable (æ¸©æš–)',
        onyx: 'Onyx (å¼ºåŠ²)',
        nova: 'Nova (å‹å–„)',
        shimmer: 'Shimmer (æ˜Žäº®)',
        apiKeyNotSet: 'âŒ APIå¯†é’¥æœªè®¾ç½®ï¼Œæ— æ³•èŽ·å–ç»æ–‡',
        errorGettingVerse: 'âŒ èŽ·å–ç»æ–‡æ—¶å‡ºé”™ï¼Œè¯·ç¨åŽå†è¯•',
        audioPlayError: 'æ— æ³•æ’­æ”¾éŸ³é¢‘ï¼Œè¯·ç¨åŽå†è¯•',
        parseError: 'âš ï¸ æœªèƒ½è§£æžå“åº”ï¼Œä»¥ä¸‹æ˜¯åŽŸå§‹å†…å®¹ï¼š',
        apiKeyNotSetAudio: 'APIå¯†é’¥æœªè®¾ç½®ï¼Œæ— æ³•æ’­æ”¾éŸ³é¢‘',
        languageSelector: 'Language',
        continuePrayer: 'ç»§ç»­æ›´é•¿çš„ç¥·å‘Š',
        prayerLabel: 'ç¥·å‘Šè¯'
    },
    // English
    'en': {
        title: 'Let me Pray With You',
        backButton: 'â†© Previous Emotions',
        loadingEmotions: 'â³ Finding more emotions...',
        customEmotionLabel: 'Please describe your current situation:',
        submitButton: 'Submit',
        resetButton: 'Reset Emotion Selection',
        otherSituation: 'I have another situation',
        loadingVerse: 'â³ Finding appropriate scripture...',
        verseForEmotion: 'ðŸ“– For those experiencing "{emotion}":',
        scripture: 'Scripture:',
        explanation: 'Explanation:',
        prayer: 'Prayer:',
        playPrayer: 'â–¶ Play Prayer',
        generatingAudio: 'â³ Generating audio...',
        voiceSelector: 'Select Voice',
        alloy: 'Alloy (Balanced)',
        echo: 'Echo (Deep)',
        fable: 'Fable (Warm)',
        onyx: 'Onyx (Strong)',
        nova: 'Nova (Friendly)',
        shimmer: 'Shimmer (Bright)',
        apiKeyNotSet: 'âŒ API key not set, cannot retrieve scripture',
        errorGettingVerse: 'âŒ Error getting scripture, please try again later',
        audioPlayError: 'Cannot play audio, please try again later',
        parseError: 'âš ï¸ Could not parse response, here is the original content:',
        apiKeyNotSetAudio: 'API key not set, cannot play audio',
        languageSelector: 'Language',
        continuePrayer: 'Continue with a longer prayer',
        prayerLabel: 'Prayer'
    },
    // Japanese
    'ja': {
        title: 'ä¸€ç·’ã«ç¥ˆã‚Šã¾ã—ã‚‡ã†',
        backButton: 'â†© å‰ã®æ„Ÿæƒ…ãƒªã‚¹ãƒˆ',
        loadingEmotions: 'â³ æ„Ÿæƒ…ã‚’æŽ¢ã—ã¦ã„ã¾ã™...',
        customEmotionLabel: 'ç¾åœ¨ã®çŠ¶æ³ã‚’èª¬æ˜Žã—ã¦ãã ã•ã„ï¼š',
        submitButton: 'é€ä¿¡',
        resetButton: 'æ„Ÿæƒ…é¸æŠžã‚’ãƒªã‚»ãƒƒãƒˆ',
        otherSituation: 'ä»–ã®çŠ¶æ³ãŒã‚ã‚Šã¾ã™',
        loadingVerse: 'â³ é©åˆ‡ãªè–æ›¸ã®è¨€è‘‰ã‚’æŽ¢ã—ã¦ã„ã¾ã™...',
        verseForEmotion: 'ðŸ“– ã€Œ{emotion}ã€ã‚’çµŒé¨“ã—ã¦ã„ã‚‹æ–¹ã¸ï¼š',
        scripture: 'è–æ›¸ï¼š',
        explanation: 'èª¬æ˜Žï¼š',
        prayer: 'ç¥ˆã‚Šï¼š',
        playPrayer: 'â–¶ ç¥ˆã‚Šã‚’å†ç”Ÿ',
        generatingAudio: 'â³ éŸ³å£°ã‚’ç”Ÿæˆä¸­...',
        voiceSelector: 'éŸ³å£°ã‚’é¸æŠž',
        alloy: 'Alloy (ãƒãƒ©ãƒ³ã‚¹)',
        echo: 'Echo (æ·±ã„)',
        fable: 'Fable (æ¸©ã‹ã„)',
        onyx: 'Onyx (åŠ›å¼·ã„)',
        nova: 'Nova (è¦ªã—ã¿ã‚„ã™ã„)',
        shimmer: 'Shimmer (æ˜Žã‚‹ã„)',
        apiKeyNotSet: 'âŒ APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€è–æ›¸ã®è¨€è‘‰ã‚’å–å¾—ã§ãã¾ã›ã‚“',
        errorGettingVerse: 'âŒ è–æ›¸ã®è¨€è‘‰ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€å¾Œã§ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„',
        audioPlayError: 'éŸ³å£°ã‚’å†ç”Ÿã§ãã¾ã›ã‚“ã€å¾Œã§ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„',
        parseError: 'âš ï¸ å¿œç­”ã‚’è§£æžã§ãã¾ã›ã‚“ã§ã—ãŸã€ä»¥ä¸‹ã¯å…ƒã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™ï¼š',
        apiKeyNotSetAudio: 'APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€éŸ³å£°ã‚’å†ç”Ÿã§ãã¾ã›ã‚“',
        languageSelector: 'Language',
        continuePrayer: 'ã•ã‚‰ã«é•·ã„ç¥ˆã‚Šã‚’ç¶šã‘ã‚‹',
        prayerLabel: 'ç¥ˆã‚Š'
    },
    // Korean
    'ko': {
        title: 'í•¨ê»˜ ê¸°ë„í•´ìš”',
        backButton: 'â†© ì´ì „ ê°ì • ëª©ë¡',
        loadingEmotions: 'â³ ê°ì •ì„ ì°¾ëŠ” ì¤‘...',
        customEmotionLabel: 'í˜„ìž¬ ìƒí™©ì„ ì„¤ëª…í•´ ì£¼ì„¸ìš”:',
        submitButton: 'ì œì¶œ',
        resetButton: 'ê°ì • ì„ íƒ ì´ˆê¸°í™”',
        otherSituation: 'ë‹¤ë¥¸ ìƒí™©ì´ ìžˆì–´ìš”',
        loadingVerse: 'â³ ì ì ˆí•œ ì„±ê²½ êµ¬ì ˆì„ ì°¾ëŠ” ì¤‘...',
        verseForEmotion: 'ðŸ“– "{emotion}"ì„(ë¥¼) ê²½í—˜í•˜ê³  ìžˆëŠ” ë‹¹ì‹ ì—ê²Œ:',
        scripture: 'ì„±ê²½ êµ¬ì ˆ:',
        explanation: 'ì„¤ëª…:',
        prayer: 'ê¸°ë„:',
        playPrayer: 'â–¶ ê¸°ë„ ìž¬ìƒ',
        generatingAudio: 'â³ ì˜¤ë””ì˜¤ ìƒì„± ì¤‘...',
        voiceSelector: 'ìŒì„± ì„ íƒ',
        alloy: 'Alloy (ê· í˜•)',
        echo: 'Echo (ê¹Šì€)',
        fable: 'Fable (ë”°ëœ»í•œ)',
        onyx: 'Onyx (ê°•í•œ)',
        nova: 'Nova (ì¹œê·¼í•œ)',
        shimmer: 'Shimmer (ë°ì€)',
        apiKeyNotSet: 'âŒ API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì„±ê²½ êµ¬ì ˆì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
        errorGettingVerse: 'âŒ ì„±ê²½ êµ¬ì ˆì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”',
        audioPlayError: 'ì˜¤ë””ì˜¤ë¥¼ ìž¬ìƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”',
        parseError: 'âš ï¸ ì‘ë‹µì„ ë¶„ì„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ìŒì€ ì›ë³¸ ë‚´ìš©ìž…ë‹ˆë‹¤:',
        apiKeyNotSetAudio: 'API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì˜¤ë””ì˜¤ë¥¼ ìž¬ìƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
        languageSelector: 'Language',
        continuePrayer: 'ë” ê¸´ ê¸°ë„ë¥¼ ì´ì–´ê°€ê¸°',
        prayerLabel: 'ê¸°ë„'
    },
    // German
    'de': {
        title: 'Lass mich mit dir beten',
        backButton: 'â†© Vorherige Emotionen',
        loadingEmotions: 'â³ Suche nach weiteren Emotionen...',
        customEmotionLabel: 'Bitte beschreibe deine aktuelle Situation:',
        submitButton: 'Absenden',
        resetButton: 'Emotionsauswahl zurÃ¼cksetzen',
        otherSituation: 'Ich habe eine andere Situation',
        loadingVerse: 'â³ Suche nach passender Bibelstelle...',
        verseForEmotion: 'ðŸ“– FÃ¼r diejenigen, die "{emotion}" erleben:',
        scripture: 'Bibelstelle:',
        explanation: 'ErklÃ¤rung:',
        prayer: 'Gebet:',
        playPrayer: 'â–¶ Gebet abspielen',
        generatingAudio: 'â³ Audio wird generiert...',
        voiceSelector: 'Stimme auswÃ¤hlen',
        alloy: 'Alloy (Ausgeglichen)',
        echo: 'Echo (Tief)',
        fable: 'Fable (Warm)',
        onyx: 'Onyx (Stark)',
        nova: 'Nova (Freundlich)',
        shimmer: 'Shimmer (Hell)',
        apiKeyNotSet: 'âŒ API-SchlÃ¼ssel nicht gesetzt, Bibelstelle kann nicht abgerufen werden',
        errorGettingVerse: 'âŒ Fehler beim Abrufen der Bibelstelle, bitte versuche es spÃ¤ter erneut',
        audioPlayError: 'Audio kann nicht abgespielt werden, bitte versuche es spÃ¤ter erneut',
        parseError: 'âš ï¸ Antwort konnte nicht analysiert werden, hier ist der ursprÃ¼ngliche Inhalt:',
        apiKeyNotSetAudio: 'API-SchlÃ¼ssel nicht gesetzt, Audio kann nicht abgespielt werden',
        languageSelector: 'Sprache',
        continuePrayer: 'Mit einem lÃ¤ngeren Gebet fortfahren',
        prayerLabel: 'Gebet'
    },
    // French
    'fr': {
        title: 'Prions ensemble',
        backButton: 'â†© Ã‰motions prÃ©cÃ©dentes',
        loadingEmotions: 'â³ Recherche d\'Ã©motions supplÃ©mentaires...',
        customEmotionLabel: 'Veuillez dÃ©crire votre situation actuelle:',
        submitButton: 'Soumettre',
        resetButton: 'RÃ©initialiser la sÃ©lection d\'Ã©motions',
        otherSituation: 'J\'ai une autre situation',
        loadingVerse: 'â³ Recherche d\'un verset appropriÃ©...',
        verseForEmotion: 'ðŸ“– Pour ceux qui ressentent "{emotion}":',
        scripture: 'Ã‰criture:',
        explanation: 'Explication:',
        prayer: 'PriÃ¨re:',
        playPrayer: 'â–¶ Ã‰couter la priÃ¨re',
        generatingAudio: 'â³ GÃ©nÃ©ration de l\'audio...',
        voiceSelector: 'SÃ©lectionner une voix',
        alloy: 'Alloy (Ã‰quilibrÃ©e)',
        echo: 'Echo (Profonde)',
        fable: 'Fable (Chaleureuse)',
        onyx: 'Onyx (Forte)',
        nova: 'Nova (Amicale)',
        shimmer: 'Shimmer (Claire)',
        apiKeyNotSet: 'âŒ ClÃ© API non dÃ©finie, impossible de rÃ©cupÃ©rer les Ã©critures',
        errorGettingVerse: 'âŒ Erreur lors de la rÃ©cupÃ©ration des Ã©critures, veuillez rÃ©essayer plus tard',
        audioPlayError: 'Impossible de lire l\'audio, veuillez rÃ©essayer plus tard',
        parseError: 'âš ï¸ Impossible d\'analyser la rÃ©ponse, voici le contenu original:',
        apiKeyNotSetAudio: 'ClÃ© API non dÃ©finie, impossible de lire l\'audio',
        languageSelector: 'Langue',
        continuePrayer: 'Continuer avec une priÃ¨re plus longue',
        prayerLabel: 'PriÃ¨re'
    },
    // Italian
    'it': {
        title: 'Preghiamo insieme',
        backButton: 'â†© Emozioni precedenti',
        loadingEmotions: 'â³ Ricerca di altre emozioni...',
        customEmotionLabel: 'Per favore descrivi la tua situazione attuale:',
        submitButton: 'Invia',
        resetButton: 'Reimposta selezione emozioni',
        otherSituation: 'Ho un\'altra situazione',
        loadingVerse: 'â³ Ricerca di un versetto appropriato...',
        verseForEmotion: 'ðŸ“– Per coloro che provano "{emotion}":',
        scripture: 'Scrittura:',
        explanation: 'Spiegazione:',
        prayer: 'Preghiera:',
        playPrayer: 'â–¶ Ascolta la preghiera',
        generatingAudio: 'â³ Generazione dell\'audio...',
        voiceSelector: 'Seleziona voce',
        alloy: 'Alloy (Equilibrata)',
        echo: 'Echo (Profonda)',
        fable: 'Fable (Calda)',
        onyx: 'Onyx (Forte)',
        nova: 'Nova (Amichevole)',
        shimmer: 'Shimmer (Chiara)',
        apiKeyNotSet: 'âŒ Chiave API non impostata, impossibile recuperare le scritture',
        errorGettingVerse: 'âŒ Errore durante il recupero delle scritture, riprova piÃ¹ tardi',
        audioPlayError: 'Impossibile riprodurre l\'audio, riprova piÃ¹ tardi',
        parseError: 'âš ï¸ Impossibile analizzare la risposta, ecco il contenuto originale:',
        apiKeyNotSetAudio: 'Chiave API non impostata, impossibile riprodurre l\'audio',
        languageSelector: 'Lingua',
        continuePrayer: 'Continua con una preghiera piÃ¹ lunga',
        prayerLabel: 'Preghiera'
    },
    // Dutch
    'nl': {
        title: 'Laten we samen bidden',
        backButton: 'â†© Vorige emoties',
        loadingEmotions: 'â³ Zoeken naar meer emoties...',
        customEmotionLabel: 'Beschrijf alstublieft uw huidige situatie:',
        submitButton: 'Verzenden',
        resetButton: 'Emotieselectie resetten',
        otherSituation: 'Ik heb een andere situatie',
        loadingVerse: 'â³ Zoeken naar een passend vers...',
        verseForEmotion: 'ðŸ“– Voor degenen die "{emotion}" ervaren:',
        scripture: 'Schrift:',
        explanation: 'Uitleg:',
        prayer: 'Gebed:',
        playPrayer: 'â–¶ Gebed afspelen',
        generatingAudio: 'â³ Audio genereren...',
        voiceSelector: 'Stem selecteren',
        alloy: 'Alloy (Gebalanceerd)',
        echo: 'Echo (Diep)',
        fable: 'Fable (Warm)',
        onyx: 'Onyx (Sterk)',
        nova: 'Nova (Vriendelijk)',
        shimmer: 'Shimmer (Helder)',
        apiKeyNotSet: 'âŒ API-sleutel niet ingesteld, kan geen schrift ophalen',
        errorGettingVerse: 'âŒ Fout bij het ophalen van schrift, probeer het later opnieuw',
        audioPlayError: 'Kan audio niet afspelen, probeer het later opnieuw',
        parseError: 'âš ï¸ Kon het antwoord niet analyseren, hier is de originele inhoud:',
        apiKeyNotSetAudio: 'API-sleutel niet ingesteld, kan audio niet afspelen',
        languageSelector: 'Taal',
        continuePrayer: 'Doorgaan met een langer gebed',
        prayerLabel: 'Gebed'
    },
    // Spanish
    'es': {
        title: 'Oremos juntos',
        backButton: 'â†© Emociones anteriores',
        loadingEmotions: 'â³ Buscando mÃ¡s emociones...',
        customEmotionLabel: 'Por favor describe tu situaciÃ³n actual:',
        submitButton: 'Enviar',
        resetButton: 'Reiniciar selecciÃ³n de emociÃ³n',
        otherSituation: 'Tengo otra situaciÃ³n',
        loadingVerse: 'â³ Buscando escritura apropiada...',
        verseForEmotion: 'ðŸ“– Para aquellos que experimentan "{emotion}":',
        scripture: 'Escritura:',
        explanation: 'ExplicaciÃ³n:',
        prayer: 'OraciÃ³n:',
        playPrayer: 'â–¶ Reproducir oraciÃ³n',
        generatingAudio: 'â³ Generando audio...',
        voiceSelector: 'Seleccionar voz',
        alloy: 'Alloy (Equilibrada)',
        echo: 'Echo (Profunda)',
        fable: 'Fable (CÃ¡lida)',
        onyx: 'Onyx (Fuerte)',
        nova: 'Nova (Amigable)',
        shimmer: 'Shimmer (Brillante)',
        apiKeyNotSet: 'âŒ Clave API no configurada, no se puede recuperar la escritura',
        errorGettingVerse: 'âŒ Error al obtener la escritura, por favor intenta mÃ¡s tarde',
        audioPlayError: 'No se puede reproducir el audio, por favor intenta mÃ¡s tarde',
        parseError: 'âš ï¸ No se pudo analizar la respuesta, aquÃ­ estÃ¡ el contenido original:',
        apiKeyNotSetAudio: 'Clave API no configurada, no se puede reproducir el audio',
        languageSelector: 'Idioma',
        continuePrayer: 'Continuar con una oraciÃ³n mÃ¡s larga',
        prayerLabel: 'OraciÃ³n'
    }
};

// Get the current language or default to Traditional Chinese
function getCurrentLanguage() {
    return localStorage.getItem('preferredLanguage') || 'zh-Hant';
}

// Set the current language
function setCurrentLanguage(lang) {
    localStorage.setItem('preferredLanguage', lang);
    updatePageLanguage();
}

// Get a translated string
function t(key, replacements = {}) {
    const lang = getCurrentLanguage();
    const text = translations[lang][key] || translations['zh-Hant'][key] || key;
    
    // Replace any placeholders in the text
    return Object.keys(replacements).reduce((str, placeholder) => {
        return str.replace(`{${placeholder}}`, replacements[placeholder]);
    }, text);
}

// Update the page language
function updatePageLanguage() {
    const lang = getCurrentLanguage();
    
    // Update HTML lang attribute
    document.documentElement.lang = lang;
    
    // Update page title
    document.title = t('title');
    
    // Update main heading
    const mainHeading = document.querySelector('h1');
    if (mainHeading) {
        mainHeading.textContent = t('title');
    }
    
    // Update back button
    const backButton = document.getElementById('backButton');
    if (backButton) {
        backButton.textContent = t('backButton');
    }
    
    // Update any existing emotion buttons
    updateEmotionButtons();
    
    // Update verse content if it exists
    updateVerseContent();
    
    // Update voice selector if it exists
    updateVoiceSelector();
}

// Update emotion buttons with translated text
function updateEmotionButtons() {
    const mainEmotions = document.getElementById('mainEmotions');
    if (!mainEmotions) return;
    
    // Check if we're in the custom emotion input view
    const customInput = document.getElementById('customEmotionInput');
    if (customInput) {
        // Update the custom emotion input view
        const label = mainEmotions.querySelector('p');
        if (label) label.textContent = t('customEmotionLabel');
        
        const submitBtn = mainEmotions.querySelector('button:nth-of-type(1)');
        if (submitBtn) submitBtn.textContent = t('submitButton');
        
        const resetBtn = mainEmotions.querySelector('button:nth-of-type(2)');
        if (resetBtn) resetBtn.textContent = t('resetButton');
        
        return;
    }
    
    // Update regular emotion buttons
    const buttons = mainEmotions.querySelectorAll('button');
    buttons.forEach(btn => {
        if (btn.textContent === 'æˆ‘æœ‰å…¶ä»–ç‹€æ³' || 
            btn.textContent === 'æˆ‘æœ‰å…¶ä»–çŠ¶å†µ' || 
            btn.textContent === 'I have another situation' ||
            btn.textContent === 'ä»–ã®çŠ¶æ³ãŒã‚ã‚Šã¾ã™' ||
            btn.textContent === 'ë‹¤ë¥¸ ìƒí™©ì´ ìžˆì–´ìš”' ||
            btn.textContent === 'Ich habe eine andere Situation' ||
            btn.textContent === 'J\'ai une autre situation' ||
            btn.textContent === 'Ho un\'altra situazione' ||
            btn.textContent === 'Ik heb een andere situatie') {
            btn.textContent = t('otherSituation');
        }
    });
}

// Update verse content with translated text
function updateVerseContent() {
    const verseElement = document.getElementById('verse');
    if (!verseElement || verseElement.innerHTML.trim() === '') return;
    
    // Check if we're in the loading state
    if (verseElement.textContent.includes('æ­£åœ¨å°‹æ‰¾åˆé©çš„ç¶“æ–‡') || 
        verseElement.textContent.includes('æ­£åœ¨å¯»æ‰¾åˆé€‚çš„ç»æ–‡') || 
        verseElement.textContent.includes('Finding appropriate scripture') ||
        verseElement.textContent.includes('é©åˆ‡ãªè–æ›¸ã®è¨€è‘‰ã‚’æŽ¢ã—ã¦ã„ã¾ã™') ||
        verseElement.textContent.includes('ì ì ˆí•œ ì„±ê²½ êµ¬ì ˆì„ ì°¾ëŠ” ì¤‘') ||
        verseElement.textContent.includes('Suche nach passender Bibelstelle') ||
        verseElement.textContent.includes('Recherche d\'un verset appropriÃ©') ||
        verseElement.textContent.includes('Ricerca di un versetto appropriato') ||
        verseElement.textContent.includes('Zoeken naar een passend vers')) {
        verseElement.innerHTML = t('loadingVerse');
        return;
    }
    
    // Check if we're in the error state
    if (verseElement.textContent.includes('APIé‡‘é‘°æœªè¨­ç½®') || 
        verseElement.textContent.includes('APIå¯†é’¥æœªè®¾ç½®') || 
        verseElement.textContent.includes('API key not set') ||
        verseElement.textContent.includes('APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“') ||
        verseElement.textContent.includes('API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤') ||
        verseElement.textContent.includes('API-SchlÃ¼ssel nicht gesetzt') ||
        verseElement.textContent.includes('ClÃ© API non dÃ©finie') ||
        verseElement.textContent.includes('Chiave API non impostata') ||
        verseElement.textContent.includes('API-sleutel niet ingesteld')) {
        verseElement.innerHTML = t('apiKeyNotSet');
        return;
    }
    
    if (verseElement.textContent.includes('ç²å–ç¶“æ–‡æ™‚å‡ºéŒ¯') || 
        verseElement.textContent.includes('èŽ·å–ç»æ–‡æ—¶å‡ºé”™') || 
        verseElement.textContent.includes('Error getting scripture') ||
        verseElement.textContent.includes('è–æ›¸ã®è¨€è‘‰ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ') ||
        verseElement.textContent.includes('ì„±ê²½ êµ¬ì ˆì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤') ||
        verseElement.textContent.includes('Fehler beim Abrufen der Bibelstelle') ||
        verseElement.textContent.includes('Erreur lors de la rÃ©cupÃ©ration des Ã©critures') ||
        verseElement.textContent.includes('Errore durante il recupero delle scritture') ||
        verseElement.textContent.includes('Fout bij het ophalen van schrift')) {
        verseElement.innerHTML = t('errorGettingVerse');
        return;
    }
    
    // If we have a full verse display, update the labels but keep the content
    const h3 = verseElement.querySelector('h3');
    if (h3) {
        // Extract the emotion from the heading
        const emotionMatch = h3.textContent.match(/ã€Œ(.+?)ã€/) || h3.textContent.match(/"(.+?)"/);
        const emotion = emotionMatch ? emotionMatch[1] : '';
        
        h3.textContent = t('verseForEmotion', { emotion });
    }
    
    // Update the scripture, explanation, and prayer labels
    const paragraphs = verseElement.querySelectorAll('p');
    if (paragraphs.length >= 3) {
        const scriptureStrong = paragraphs[0].querySelector('strong');
        if (scriptureStrong) scriptureStrong.textContent = t('scripture');
        
        const explanationStrong = paragraphs[1].querySelector('strong');
        if (explanationStrong) explanationStrong.textContent = t('explanation');
        
        const prayerStrong = paragraphs[2].querySelector('strong');
        if (prayerStrong) prayerStrong.textContent = t('prayer');
    }
    
    // Update the play button text
    const playButton = document.getElementById('play-text');
    if (playButton) playButton.textContent = t('playPrayer');
    
    const loadingSpinner = document.getElementById('loading-spinner');
    if (loadingSpinner) loadingSpinner.textContent = t('generatingAudio');
    
    // Update voice selector label
    const voiceSelectorLabel = document.getElementById('voice-selector-label');
    if (voiceSelectorLabel) voiceSelectorLabel.textContent = t('voiceSelector') + ':';
}

// Update voice selector with translated text
function updateVoiceSelector() {
    const voiceSelector = document.getElementById('voice-selector');
    if (!voiceSelector) return;
    
    // Update voice options
    Array.from(voiceSelector.options).forEach(option => {
        const voiceKey = option.value.toLowerCase();
        if (translations[getCurrentLanguage()][voiceKey]) {
            option.textContent = translations[getCurrentLanguage()][voiceKey];
        }
    });
}

// Initialize language on page load
document.addEventListener('DOMContentLoaded', updatePageLanguage);
